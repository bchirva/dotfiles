#!/usr/bin/env sh

main() {
    operation=$1
    channel=$2

    case "$channel" in 
        output) channel="sink" ;;
        input)  channel="source" ;;
        *) exit 1 ;;
    esac 

    case $operation in
        status)
            active_device_id="$(pactl "get-default-${channel}")"
            device_mute="$(pactl "get-${channel}-mute" "$active_device_id" \
                | sed "s/^[^ ]* // ; s/yes/true/ ; s/no/false/")"

            if "$device_mute" ; then
                case $channel in
                    sink)   printf '%s\n' "󰝟" ;;
                    source) printf '%s\n' "󰍭" ;;
                esac
            else
                device_volume="$(pactl "get-${channel}-volume" "$active_device_id" \
                    | grep -o "[0-9]*%" \
                    | head -n 1)"

                case $channel in
                    sink)   printf '%s\n' " $device_volume" ;;
                    source) printf '%s\n' "󰍬 $device_volume" ;;
                esac
            fi
        ;;
        menu) rofi-audio "$channel" ;;
        *) exit 2 ;;
    esac
}

main "$@"

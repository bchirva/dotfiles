#!/usr/bin/env sh

main() {
    operation=$1

    case $operation in 
        status)
            if "$(bluetoothctl show \
                | sed "s/^[[:space:]]*// ; s/yes/true/; s/no/false/" \
                | grep "Powered:" \
                | cut -d ' ' -f 2)"; then 

                connected_count=0
                for device_id in $(bluetoothctl devices \
                    | grep "^Device:" \
                    | cut -d ' ' -f 2); do 

                    if bluetoothctl info "$device_id" \
                        | grep -q "Connected: yes"; then 

                        connected_count=$((connected_count + 1))
                    fi
                done 

                if [ "$connected_count" -gt 0 ]; then
                    printf '%s\n' "󰂱 $connected_count"
                else 
                    printf '%s\n' "󰂯"
                fi
            else 
                printf '%s\n' "󰂲"; 
            fi 
        ;;
        menu) rofi-bluetooth main;;
        *) exit 2;;
    esac
}

main "$@"

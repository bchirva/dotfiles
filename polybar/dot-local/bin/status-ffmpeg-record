#!/usr/bin/env sh

RECORD_PID_FILE="${XDG_RUNTIME_DIR}/ffmpeg.record.pid"

case $1 in 
    icon)
        if [ -f "$RECORD_PID_FILE" ]; then 
            printf '%s\n' "ï€½"
        else 
            printf '%s\n' "" 
            # printf '%s\n' " "
        fi 
        ;;
    stop)
        if [ -f "$RECORD_PID_FILE" ]; then 
            ffmpeg_pid="$(head -n 1 "$RECORD_PID_FILE")"
            kill -INT "${ffmpeg_pid}" 
            wait "${ffmpeg_pid}"
            notify-send -u normal -i record-desktop "Screen recording has finished" "Record saved in $(tail -n 1 "$RECORD_PID_FILE")"
            rm "$RECORD_PID_FILE"
            exit 0
        fi 
        ;;

    *) exit 2
esac 


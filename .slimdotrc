#!/bin/bash

_colorschemes() {
    python3 ./colorschemes/build_colorscheme.py --all
    if [ ! -e "${PWD}/colorschemes/build/active" ]; then
        ln -sf "${PWD}/colorschemes/build/onedark" "${PWD}/colorschemes/build/active"
    fi
}

_link_bin() {
    ln -sf "${PWD}"/bin/* "${HOME}"/.local/bin/
}

_link_apps() {
    ln -sf "${PWD}"/applications/* "${HOME}"/.local/share/applications
}

_make_std_dirs() {
    mkdir -p "${HOME}"/.cache/zsh/
    mkdir -p "${HOME}"/.config
    mkdir -p "${HOME}"/.local/bin
    mkdir -p "${HOME}"/.local/share/fonts
    mkdir -p "${HOME}"/.local/share/icons
    mkdir -p "${HOME}"/.themes
}

_deploy_ui_theme() {
    [ -e "${HOME}/.config/Kvantum" ] && mv "${HOME}/.config/Kvantum" "${HOME}/.config/Kvantum.backup"
    [ -e "${HOME}/.themes/Quartz" ] && mv "${HOME}/.themes/Quartz" "${HOME}/.themes/Quartz.backup"  
    [ -e "${HOME}/.config/gtk-2.0" ] && mv "${HOME}/.config/gtk-2.0" "${HOME}/.config/gtk-2.0.backup"
    [ -e "${HOME}/.config/gtk-3.0" ] && mv "${HOME}/.config/gtk-3.0" "${HOME}/.config/gtk-3.0.backup"

    ln -sf "${PWD}"/ui/kvantum "${HOME}"/.config/Kvantum
    ln -sf "${PWD}"/ui/gtk/theme/Quartz "${HOME}"/.themes/Quartz
    ln -sf "${PWD}"/ui/gtk/config/* "${HOME}"/.config/

    python3 ./colorschemes/build_colorscheme.py --all --gtk
}

SLIMDOT_IGNORE=(
    wacom
    bootstrap-all.sh
    bootstrap-dev.sh
    xorg-nvidia.conf
    xorg-nouveau.conf
    )

SLIMDOT_RULES=(
    "dev fzf git lazygit lazydocker nvim shell tmux yazi zsh zprofile"
    "ui dirs ui"
    )

SLIMDOT_ACTIONS=(
    "dirs _make_std_dirs"
    "applications _link_apps"
    "bin _link_bin"
    "colorschemes _colorschemes"
    "ui _deploy_ui_theme"
    )


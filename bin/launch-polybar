#!/usr/bin/env sh

main() {
    window_manager="$1"
    polybar_config="${XDG_CONFIG_HOME}/polybar/config_${window_manager}.ini"

    monitor_name="" 
    bar=""

    xrandr | grep "\<connected\>" | while IFS= read -r line; do
        monitor_name=$(printf '%s\n' "$line" | cut -d ' ' -f 1)

        if printf '%s' "$line" | grep -q "\<primary\>"; then 
            bar="mainbar"
        else 
            bar="auxbar"
        fi

        # shellcheck disable=SC2059
        MONITOR="$monitor_name" polybar -c "$polybar_config" "$bar" & 
    done
}

main "$@"

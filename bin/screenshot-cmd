#!/usr/bin/env bash

function main() {
    local -r help_msg="screenshot-cmd
        select - screenshot of select area or window 
        focused - screenshot of focused window"

    local -r timestamp_format="%Y%m%d%H%M%S"
    local -r screenshots_path="$HOME/Images/screenshots"
    local -r clipboard_cmd='xclip -selection clipboard -target image/png -i $f'
    local -r notification_cmd='notify-send -u normal -i accessories-screenshot "Screenshot" "saved in $f"'

    case $1 in 
        select) screenshot_select;;
        focused) screenshot_focused;;
        screen) screenshot_screen "$2";;
        -h|--help) echo -e "${help_msg}";;
        *) exit 2;;
    esac 
}


function screenshot_select {
    scrot -s -f "${screenshots_path}/screenshot_${timestamp_format}.png" -e "${clipboard_cmd} & ${notification_cmd}"
}

function screenshot_focused {
    scrot -u -f "${screenshots_path}/screenshot_${timestamp_format}.png" -e "${clipboard_cmd} & ${notification_cmd}"
}

function screenshot_screen {
    local -r screen="$1"
    local -r geometry=$(xrandr | grep -A1 "^${screen} connected" \
        | grep -oP '\d+x\d+\+\d+\+\d+' \
        | awk -F '[x+]' '{print $3 "," $4 "," $1 "," $2}')

    scrot -a "${geometry}" -f "${screenshots_path}/screenshot_${timestamp_format}.png" \
                    -e "${clipboard_cmd} & ${notification_cmd}"
}

main "$@"
